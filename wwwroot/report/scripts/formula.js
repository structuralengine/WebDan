new function(){var Cell=function(row,column,sheetName){this.row=row;this.column=column;if(sheetName==undefined)this.sheetName="";else this.sheetName=sheetName},Range=function(beginRow,beginColumn,endRow,endColumn,sheetName){this.beginRow=beginRow;this.beginColumn=beginColumn;this.endRow=endRow;this.endColumn=endColumn;if(sheetName==undefined)this.sheetName="";else this.sheetName=sheetName};Formula=function(){};Formula.prototype.Parse=function(cellValues,text,referenceVariables){var tokens=GetToken(text,false);if(cellValues!=null)return GetDispValue(tokens,0,tokens.length);for(var cellPoss=[],i=0;i<tokens.length;i++)if(IsIdentifier(tokens[i])){if(i<tokens.length-1&&tokens[i+1]=="(")continue;try{var value=GetVariableValue(tokens[i]);value instanceof Cell&&value.sheetName==""&&cellPoss.push([value.row,value.column]);value instanceof Range&&value.sheetName==""&&cellPoss.push([value.beginRow,value.beginColumn,value.endRow,value.endColumn])}catch(e){}}return cellPoss;function GetToken(text,idMode){var idMode2=idMode,tokenList=[],prevKind=4,si=0,c;while(si<text.length){c=text.charAt(si);if(c==" "||c=="\t"||c=="\r"||c=="\n"||c=="$"||c=="'"){si++;continue}if(text.charAt(si)=="#")break;var kind=4;if(c=='"')kind=1;if(c.match(/[0-9]/)||c=="-"&&prevKind==4)kind=2;if(c.match(/[a-z]/i)||c=="_"||c.charCodeAt(0)>=256)kind=3;if(c==".")kind=0;var priod=c==".",quote=c,ci=si+1;while(ci<text.length){var c2=text.charAt(ci);if(c2=="$"||c2=="'"){ci++;continue}if(kind==0)kind=c2.match(/[0-9]/)?2:3;if(kind==3&&!idMode2&&c2=="["){var bracketCount=1;while(true){ci++;if(ci==text.length)return null;c2=text.charAt(ci);if(c2=='"'){while(true){ci++;if(ci==text.length)return null;if(text.charAt(ci)=='"')break}continue}if(c2=="[")bracketCount++;if(c2=="]"){bracketCount--;if(bracketCount==0)break}}ci++;continue}if(idMode){if(c2=="[")idMode2=false;if(c2=="]")idMode2=true}if(kind==1&&c2==quote){if(ci+1<text.length){var ctmp=text.charAt(ci+1);if(ctmp==quote){ci+=2;continue}}break}if(kind==2&&!c2.match(/[0-9]/)&&(c2!="."||priod)||kind==3&&!c2.match(/[0-9]/)&&!c2.match(/[a-z]/i)&&c2!="_"&&c2!="."&&c2!=":"&&c2!="!"&&c2.charCodeAt(0)<256)break;if(kind==4){if(c==">"&&c2=="="||c=="<"&&(c2=="="||c2==">")||c=="|"&&c2=="|"||c=="&"&&c2=="&")ci++;break}ci++;if(c2==".")priod=true}if(kind==1)if(ci==text.length)return null;var tokenwork=text.substr(si,ci-si);if(tokenwork.charAt(0)!='"'){tokenwork=replaceAll(tokenwork,"$","");tokenwork=replaceAll(tokenwork,"'","")}if(kind!=1)tokenList.push(tokenwork);else tokenList.push(replaceAll(tokenwork,'""','"'));if(kind==1)ci++;prevKind=kind;si=ci}return tokenList}function replaceAll(expression,org,dest){return expression.split(org).join(dest)}function GetDispValue(tokens,beginIndex,endIndex){var value=GetValue(tokens,beginIndex,endIndex);if(value instanceof Cell){var text=GetStringFromCell(value.row,value.column,value.sheetName);if(text=="")return "";var num=parseFloat(text.replace(/[^0-9.\-]/g,""));if(isNaN(num))return text;return num}return value}function GetValue(tokens,beginIndex,endIndex){for(var postfix=[],opStack=[],monadic=true,t=beginIndex;t<endIndex;t++){var token=tokens[t],c=token.charAt(0);if(c.match(/[0-9]/||(c=="."||c=="-")&&token.length>1&&token.charAt(1).match(/[0-9]/))){var value=Number(token);if(isNaN(value))throw new FormulaException(value+"\u306f\u6570\u5024\u306b\u5909\u63db\u3067\u304d\u307e\u305b\u3093");postfix.push(value);monadic=false;continue}if(c=='"'){postfix.push(token.substr(1));monadic=false;continue}if(IsIdentifier(token)){if(t+1<endIndex&&tokens[t+1]=="("){var endBracketPos=GetEndBracketPos(tokens,t+1,endIndex);postfix.push(Function(tokens,t,endBracketPos));t=endBracketPos}else{var varname=GetVarName(tokens[t]),value=GetVariableValue(varname);if(value==null)throw new FormulaException(varname+"\u306f\u672a\u5b9a\u7fa9\u306e\u5909\u6570\u3067\u3059");postfix.push(value)}monadic=false;continue}if(c=="("){opStack.push(c);monadic=true;continue}if(c==")"){while(opStack.length>0&&opStack[opStack.length-1]!="(")postfix.push(opStack.pop());if(opStack.length==0)throw new FormulaException("\u958b\u59cb\u62ec\u5f27'('\u304c\u3042\u308a\u307e\u305b\u3093");opStack.pop();monadic=false;continue}if(monadic){if(c=="+")continue;if(c=="-"){postfix.push(-1);c="*"}}monadic=true;if(token=="||")c="O";if(token=="&&")c="A";if(token=="EQ")c="=";if(token=="LT")c="<";if(token=="GT")c=">";if(token=="<>")c="N";if(token=="<=")c="L";if(token==">=")c="G";c="*"+c.toUpperCase();var Priority=OperationPriority(c);while(opStack.length>0&&OperationPriority(opStack[opStack.length-1])>=Priority)postfix.push(opStack.pop());opStack.push(c)}while(opStack.length>0)postfix.push(opStack.pop());for(var results=[],i=0;i<postfix.length;i++){var value=postfix[i];if(typeof value!="string"||value.charAt(0)!="*"){results.push(value);continue}if(results.length<2)throw new FormulaException("\u6f14\u7b97\u5b50\u306e\u4f4d\u7f6e\u304c\u4e0d\u6b63\u3067\u3059");var value2=results.pop(),value1=results.pop(),op=value.charAt(1);if((op=="A"||op=="O")&&typeof value1!="boolean")throw new FormulaException("And\u3068Or\u306f\u8ad6\u7406\u5024\u306e\u307f\u3067\u6f14\u7b97\u53ef\u80fd\u3067\u3059");if(typeof value1=="boolean"&&op!="A"&&op!="O"&&op!="=")throw new FormulaException("\u8ad6\u7406\u5024\u306fAnd\u3001Or\u307e\u305f\u306f=\u6f14\u7b97\u306e\u307f\u53ef\u80fd\u3067\u3059");if(op=="+"||op=="-"||op=="*"||op=="/"||op=="%"||op=="^"){if(value1 instanceof Cell)value1=ConvertToDecimal(value1);if(value2 instanceof Cell)value2=ConvertToDecimal(value2);if(typeof value1!="number")throw new FormulaException("+ - * / % \u306f\u6570\u5024\u306e\u307f\u3067\u6f14\u7b97\u53ef\u80fd\u3067\u3059")}if(op=="&"){if(value1 instanceof Cell)value1=ConvertToString(value1);if(value2 instanceof Cell)value2=ConvertToString(value2);if(typeof value1!="string")throw new FormulaException("& \u306f\u6587\u5b57\u5217\u306e\u307f\u3067\u6f14\u7b97\u53ef\u80fd\u3067\u3059")}var compair=0;if(op=="="||op==">"||op=="<"||op=="G"||op=="L"||op=="N"){if(value1 instanceof Cell&&value2 instanceof Cell){value1=ConvertToString(value1);var num1=parseFloat(value1.replace(/[^0-9.\-]/g,""));value2=ConvertToString(value2);var num2=parseFloat(value2.replace(/[^0-9.\-]/g,""));if(isNaN(num1)==false&&isNaN(num2)==false){value1=num1;value2=num2}}else{if(value1 instanceof Cell)if(typeof value2=="string")value1=ConvertToString(value1);else if(typeof value2=="boolean")value1=ConvertToBoolean(value1);else value1=ConvertToDecimal(value1);if(value2 instanceof Cell)if(typeof value1=="string")value2=ConvertToString(value2);else if(typeof value1=="boolean")value2=ConvertToBoolean(value2);else value2=ConvertToDecimal(value2)}if(typeof value1!=typeof value2)throw new FormulaException("\u5de6\u8fba\u3068\u53f3\u8fba\u306e\u7a2e\u985e\u304c\u9055\u3044\u307e\u3059");if(value1 instanceof Range)throw new FormulaException("\u6f14\u7b97\u5b50\u306b Range \u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");if(typeof value1=="boolean")compair=value1==value2?0:-1;else compair=value1==value2?0:value1>value2?1:-1}switch(op){case "A":value1=value1&value2;break;case "O":value1=value1|value2;break;case "=":value1=compair==0;break;case ">":value1=compair>0;break;case "<":value1=compair<0;break;case "G":value1=compair>=0;break;case "L":value1=compair<=0;break;case "N":value1=compair!=0;break;case "+":value1=value1+value2;break;case "-":value1=value1-value2;break;case "&":value1=value1+value2;break;case "*":value1=value1*value2;break;case "/":if(value2==0)throw new FormulaException("0 \u3067\u9664\u7b97\u3057\u307e\u3057\u305f");value1=value1/value2;break;case "%":if(value2==0)throw new FormulaException("0 \u3067\u9664\u7b97\u3057\u307e\u3057\u305f");value1=value1%value2;break;case "^":if(value1==0&&value2<=0)throw new FormulaException("\u3079\u304d\u4e57\u306e\u8a08\u7b97\u304c\u3067\u304d\u307e\u305b\u3093");value1=Math.pow(value1,value2);break}results.push(value1)}if(results.length!=1)throw new FormulaException("\u6f14\u7b97\u5b50\u306e\u4f4d\u7f6e\u304c\u4e0d\u6b63\u3067\u3059");var ret=results.pop();return ret}function GetVariableValue(varname){if(varname.toLowerCase()=="true")return true;if(varname.toLowerCase()=="false")return false;var exclaPos=varname.indexOf("!"),sheetName="";if(exclaPos>=0){sheetName=varname.substr(0,exclaPos);varname=varname.substr(exclaPos+1)}var index=varname.indexOf(":");if(index<0)return GetCell(varname,sheetName);else{var cell1=GetCell(varname.substr(0,index),sheetName),varname2=varname.substr(index+1),exclaPos2=varname2.indexOf("!");if(exclaPos>=0)varname2=varname2.substr(exclaPos2+1);var cell2=GetCell(varname2,sheetName);return new Range(cell1.row,cell1.column,cell2.row,cell2.column,sheetName)}}function GetCell(varname,sheetName){var ptx=-1,pty=-1,weight0=0,weight1=24,weight2=25,index=0,c;while(index<3&&index<varname.length){c=varname.charCodeAt(index);if(c>=65&&c<=90||c>=97&&c<=122){weight0=weight1;weight1=weight2;if(c>=65&&c<=90)weight2=c-65;else weight2=c-97;index++}else if(c==36)index++;else break}if(index>0){var columnIndex=(weight0*676+weight1*26+weight2+703)%17576;ptx=columnIndex-1}if(varname.length-index>0){var rowwk=parseInt(varname.substr(index,varname.length-index));if(!isNaN(rowwk))pty=rowwk-1}if(ptx==-1&&pty==-1)throw new FormulaException("\u672a\u5b9a\u7fa9\u306e\u5909\u6570\u3067\u3059");return new Cell(pty,ptx,sheetName)}function IsIdentifier(Token){var c=Token.charAt(0);if((c=="."||c=="_")&&Token.length>1)return true;var id=Token.toLowerCase();if(!c.match(/[a-z]/i)&&c.charCodeAt(0)<256||id=="eq"||id=="lt"||id=="gt"||id=="le"||id=="ge"||id=="ne")return false;return true}function GetVarName(text){for(var tokens=GetToken(text,true),varname="",i=0;i<tokens.length;i++){varname+=tokens[i];if(tokens[i]=="["){var endBracketPos=GetEndBracketPos(tokens,i,tokens.length),values=GetParams(tokens,i+1,endBracketPos);values.foreach(function(value){if(typeof value!="number")throw new FormulaException("\u914d\u5217\u306e\u6dfb\u3048\u5b57\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");varname+=value.toString()});varname+="]";i=endBracketPos}}return varname}function OperationPriority(operation){if(operation=="(")return 0;switch(operation.charAt(1)){case "A":return 1;case "O":return 1;case "=":return 2;case ">":return 2;case "<":return 2;case "G":return 2;case "L":return 2;case "N":return 2;case "+":return 3;case "-":return 3;case "&":return 3;case "*":return 4;case "/":return 4;case "%":return 4;case "^":return 4}throw new FormulaException(operation.toString()+"\u306f\u672a\u5b9a\u7fa9\u306e\u6f14\u7b97\u5b50\u3067\u3059")}function Function(tokens,beginIndex,endIndex){var functionName=tokens[beginIndex].toLowerCase(),values=GetParams(tokens,beginIndex+2,endIndex);if(functionName=="sum")return SumFunction(values);if(functionName=="if")return IfFunction(values);if(functionName=="int")return IntFunction(values);if(functionName=="mod")return ModFunction(values);if(functionName=="abs")return AbsFunction(values);if(functionName=="roundup")return RoundFunction(values,0);if(functionName=="rounddown")return RoundFunction(values,1);if(functionName=="round")return RoundFunction(values,2);if(functionName=="and")return AndFunction(values);if(functionName=="or")return OrFunction(values);if(functionName=="str")return StrFunction(values);if(functionName=="val")return ValFunction(values);if(functionName=="substitute")return SubstituteFunction(values);if(functionName=="left")return LeftFunction(values);if(functionName=="right")return RightFunction(values);if(functionName=="mid")return MidFunction(values);if(functionName=="trim")return TrimFunction(values);if(functionName=="vlookup")return VLookUpFunction(values);throw new FormulaException(functionName+"\u306f\u672a\u5b9a\u7fa9\u306e\u95a2\u6570\u3067\u3059")}function GetParams(tokens,beginIndex,endIndex){for(var values=[],i=beginIndex;i<endIndex;i++){if(tokens[i]==",")throw new FormulaException("\u95a2\u6570\u306e\u5f15\u6570\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059");for(var si=i;i<endIndex&&tokens[i]!=",";i++)if(tokens[i]=="("||tokens[i]=="["){var endBracketPos=GetEndBracketPos(tokens,i,endIndex);i=endBracketPos}values.push(GetValue(tokens,si,i))}return values}function GetEndBracketPos(tokens,beginIndex,endIndex){for(var beginBracket=tokens[beginIndex],endBracket=beginBracket=="("?")":"]",bracketCount=1,pos=beginIndex+1;pos<endIndex;pos++){if(tokens[pos]==beginBracket)bracketCount++;if(tokens[pos]==endBracket){bracketCount--;if(bracketCount==0)return pos}}throw new FormulaException("\u9589\u3058\u308b\u62ec\u5f27\u304c\u3042\u308a\u307e\u305b\u3093")}function SumFunction(values){if(values.length==0)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");for(var sum=0,i=0;i<values.length;i++){var value=values[i];if(typeof value=="number"){sum+=value;continue}if(value instanceof Cell){sum+=ConvertToDecimal(value);continue}if(value instanceof Range){for(var range=value,row=range.beginRow;row<=range.endRow;row++)for(var column=range.beginColumn;column<=range.endColumn;column++)sum+=GetDecimalFromCell(row,column,range.sheetName);continue}throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u307e\u305f\u306f\u30bb\u30eb\u3067\u306f\u3042\u308a\u307e\u305b\u3093")}return sum}function IfFunction(values){if(values.length!=2&&values.length!=3)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="boolean"&&typeof values[0]!="number"&&!(values[0]instanceof Cell))throw new FormulaException("\u6761\u4ef6\u5f0f\u304c\u9055\u3044\u307e\u3059");var condition=ConvertToBoolean(values[0]);if(condition==true){if(values[1]instanceof Range)throw new FormulaException("\u771f\u306e\u9078\u629e\u5024\u304c\u9055\u3044\u307e\u3059");return values[1]instanceof Cell?ConvertToString(values[1]):values[1]}else{if(values.length==2)return "";if(values[2]instanceof Range)throw new FormulaException("\u507d\u306e\u9078\u629e\u5024\u304c\u9055\u3044\u307e\u3059");return values[2]instanceof Cell?ConvertToString(values[2]):values[2]}}function StrFunction(values){if(values.length!=1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="number"&&!(values[0]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");return ConvertToDecimal(values[0]).toString()}function ValFunction(values){if(values.length!=1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="string"&&!(values[0]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var value=parseFloat(values[0]);if(isNaN(value))throw new FormulaException("\u6570\u5024\u306b\u5909\u63db\u3067\u304d\u306a\u3044\u6587\u5b57\u5217\u3067\u3059");return value}function SubstituteFunction(values){if(values.length!=3)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="string"&&!(values[0]instanceof Cell))throw new FormulaException("\u7b2c\uff11\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[1]!="string"&&!(values[1]instanceof Cell))throw new FormulaException("\u7b2c\uff12\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[2]!="string"&&!(values[2]instanceof Cell))throw new FormulaException("\u7b2c\uff13\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");return ConvertToString(values[0]).replace(ConvertToString(values[1]),ConvertToString(values[2]))}function LeftFunction(values){if(values.length!=2)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="string"&&!(values[0]instanceof Cell))throw new FormulaException("\u7b2c\uff11\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[1]!="number"&&!(values[1]instanceof Cell))throw new FormulaException("\u7b2c\uff12\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var text=ConvertToString(values[0]),length=ConvertToDecimal(values[1]);if(length<text.length)return text.substr(0,length);return text}function RightFunction(values){if(values.length!=2)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="string"&&!(values[0]instanceof Cell))throw new FormulaException("\u7b2c\uff11\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[1]!="number"&&!(values[1]instanceof Cell))throw new FormulaException("\u7b2c\uff12\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var text=ConvertToString(values[0]),length=ConvertToDecimal(values[1]);if(length<text.length)return text.substr(text.length-length);return text}function MidFunction(values){if(values.length!=3)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="string"&&!(values[0]instanceof Cell))throw new FormulaException("\u7b2c\uff11\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[1]!="number"&&!(values[1]instanceof Cell))throw new FormulaException("\u7b2c\uff12\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[2]!="number"&&!(values[2]instanceof Cell))throw new FormulaException("\u7b2c\uff13\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var text=ConvertToString(values[0]),start=ConvertToDecimal(values[1])-1,length=ConvertToDecimal(values[2]);if(start<0)throw new FormulaException("\u958b\u59cb\u4f4d\u7f6e\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059");for(var mid="",i=start;i<text.length&&i<start+length;i++)mid+=text.charAt(i);return mid}function TrimFunction(values){if(values.length!=1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="string"&&!(values[0]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093");return ConvertToString(values[0]).replace(/^\s+|\s+$/g,"")}function AbsFunction(values){if(values.length!=1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="number"&&!(values[0]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[0]=="number")return Math.abs(values[0]);return Math.abs(ConvertToDecimal(values[0]))}function IntFunction(values){if(values.length!=1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="number"&&!(values[0]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[0]=="number")return Math.floor(values[0]);return Math.floor(ConvertToDecimal(values[0]))}function ModFunction(values){if(values.length!=1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="number"&&!(values[0]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[1]!="number"&&!(values[1]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var dbl1=0;if(typeof values[0]=="number")dbl1=values[0];else dbl1=Math.floor(ConvertToDecimal(values[0]));var dbl2=0;if(typeof values[1]=="number")dbl2=values[1];else dbl2=Math.floor(ConvertToDecimal(values[1]));if(dbl2==0)throw new FormulaException("MOD\u30a8\u30e9\u30fc 0 \u3067\u9664\u7b97\u3057\u307e\u3057\u305f");return dbl1%dbl2}function RoundFunction(values,type){if(values.length!=2)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="number"&&!(values[0]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(typeof values[1]!="number"&&!(values[1]instanceof Cell))throw new FormulaException("\u5f15\u6570\u306e\u578b\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var dbl1=0;if(typeof values[0]=="number")dbl1=values[0];else dbl1=ConvertToDecimal(values[0]);var dbl2=0;if(typeof values[1]=="number")dbl2=values[1];else dbl2=ConvertToDecimal(values[1]);var dbl2trc=parseInt(dbl2);if(dbl2trc>308)return dbl1;if(dbl2trc<-308)return 0;var dCoef=Math.pow(10,dbl2trc),validate=dbl1*dCoef;if(isNaN(validate))return 0;if(validate==Number.NEGATIVE_INFINITY||validate==Number.POSITIVE_INFINITY)return dbl1;switch(type){case 0:return dbl1>0?Math.ceil(dbl1*dCoef)/dCoef:Math.floor(dbl1*dCoef)/dCoef;case 1:return dbl1>0?Math.floor(dbl1*dCoef)/dCoef:Math.ceil(dbl1*dCoef)/dCoef;default:return Math.round(dbl1)/dCoef}}function AndFunction(values){if(values.length<1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");for(var condition=true,loopCount=values.length,loopIndex=0;loopIndex<loopCount;loopIndex++){if(typeof values[loopIndex]!="boolean"&&typeof values[loopIndex]!="number"&&!(values[loopIndex]instanceof Cell))throw new FormulaException("\u6761\u4ef6\u5f0f\u304c\u9055\u3044\u307e\u3059");var value1=ConvertToBoolean(values[loopIndex]);condition=condition&&value1}return condition}function OrFunction(values){if(values.length<1)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");for(var condition=false,loopCount=values.length,loopIndex=0;loopIndex<loopCount;loopIndex++){if(typeof values[loopIndex]!="boolean"&&typeof values[loopIndex]!="number"&&!(values[loopIndex]instanceof Cell))throw new FormulaException("\u6761\u4ef6\u5f0f\u304c\u9055\u3044\u307e\u3059");var value1=ConvertToBoolean(values[loopIndex]);condition=condition||value1}return condition}function VLookUpFunction(values){if(values.length!=3&&values.length!=4)throw new FormulaException("\u5f15\u6570\u306e\u6570\u304c\u9055\u3044\u307e\u3059");if(typeof values[0]!="boolean"&&typeof values[0]!="number"&&typeof values[0]!="string"&&!(values[0]instanceof Cell))throw new FormulaException("\u6761\u4ef6\u5f0f\u304c\u9055\u3044\u307e\u3059");var nearyFlg=true;if(values.length==4){if(typeof values[3]!="boolean"&&!(values[loopIndex]instanceof Cell))throw new FormulaException("\u6761\u4ef6\u5f0f\u304c\u9055\u3044\u307e\u3059");nearyFlg=ConvertToBoolean(values[3])}var wkrange=0,value=values[2];if(typeof value=="number")wkrange=value;if(value instanceof Cell)wkrange=ConvertToDecimal(value);var range=parseInt(wkrange);if(range<1)throw new FormulaException("\u6761\u4ef6\u5f0f\u304c\u9055\u3044\u307e\u3059");var searchValue=values[0];if(searchValue instanceof Cell)searchValue=ConvertToString(searchValue);if(values[1]instanceof Range){var searchRange=values[1];if(range>searchRange.endColumn-searchRange.beginColumn+1)throw new FormulaException("\u30c6\u30fc\u30d6\u30eb\u306e\u7bc4\u56f2\u304c\u4e0d\u6b63\u3067\u3059\u3002");for(var getValue=null,row=searchRange.beginRow;row<=searchRange.endRow;row++){var compare=2,targetValue=null;if(typeof searchValue=="string"){var targetTmp=new Cell(row,searchRange.beginColumn,searchRange.sheetName),targetValue=ConvertToString(targetTmp),str1=searchValue,str2=targetValue;if(str1==str2)compare=0;else if(str2>str1)compare=1;else compare=-1}else if(typeof searchValue=="number"){var targetTmp=new Cell(row,searchRange.beginColumn,searchRange.sheetName),targetValue=ConvertToDecimal(targetTmp),dbl1=searchValue,dbl2=targetValue;compare=GetFlg(dbl2-dbl1)}else if(typeof searchValue=="boolean"){var targetTmp=new Cell(row,searchRange.beginColumn,searchRange.sheetName),targetValue=ConvertToBoolean(targetTmp),bl1=searchValue,bl2=targetValue;if(bl1==bl2)compare=0;else compare=bl1==true?-1:1}if(compare==0||nearyFlg==true&&compare==-1)getValue=ConvertToString(new Cell(row,searchRange.beginColumn+range-1,searchRange.sheetName));if(compare==0)break;if(nearyFlg==true&&compare==1)break}if(getValue!=null)return getValue;else return ""}return ""}function GetFlg(value){if(value==0)return 0;return value>0?1:-1}function ConvertToDecimal(value){if(typeof value=="number")return value;if(value instanceof Cell)return GetDecimalFromCell(value.row,value.column,value.sheetName);throw new FormulaException("\u5024\u304c\u6570\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093")}function ConvertToString(value){if(typeof value=="string")return value;if(value instanceof Cell)return GetStringFromCell(value.row,value.column,value.sheetName);throw new FormulaException("\u5024\u304c\u6587\u5b57\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093")}function ConvertToBoolean(value){if(typeof value=="boolean")return value;if(typeof value=="number")return value!=0;if(value instanceof Cell)return GetDecimalFromCell(value.row,value.column,value.sheetName)!=0;throw new FormulaException("\u5024\u304c\u8ad6\u7406\u5024\u3067\u306f\u3042\u308a\u307e\u305b\u3093")}function GetDecimalFromCell(row,column,sheetName){var text=GetStringFromCell(row,column,sheetName);if(text=="")return 0;var num=parseFloat(text.replace(/[^0-9.\-]/g,""));if(isNaN(num))return 0;return num}function GetStringFromCell(row,column,sheetName){if(sheetName==""||sheetName==undefined){if(row>=cellValues.length||column>=cellValues[row].length)return "";return cellValues[row][column]||""}else{if(referenceVariables==undefined)return "";var table=referenceVariables[sheetName];if(table==undefined)return "";if(row>=table.length||column>=table[row].length)return "";return table[row][column]||""}}};var FormulaException=function(message){this.message=message};FormulaException.prototype={toString:function(){return "FormulaException:"+this.message}}}