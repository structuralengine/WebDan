{"version":3,"sources":["controllers/member-section/index.js"],"names":["angular","module","controller","$scope","$compile","$log","$q","Member","SectionShape","Condition","MemberSection","ctrl","settings","memberSections","minSpareRows","colHeaders","nestedHeaders","label","colspan","columns","data","type","format","renderer","renderName","afterChange","changes","source","forEach","change","idx","prop","oldVal","newVal","memberSection","$dirty","afterRender","rootElement","sectionShapes","readOnly","rowHeaders","conditions","isDirty","some","save","isEmpty","indexOf","$id","removeMemberSection","remove","then","ref","resetDirty","add","key","e","error","splice","init","members","query"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\r\n\r\n/**\r\n * @ngdoc function\r\n * @name webdan.controller:MemberSectionIndexCtrl\r\n * @description\r\n * # MemberSectionIndexCtrl\r\n * Controller of the webdan\r\n */\r\nangular.module('webdan')\r\n  .controller('MemberSectionIndexCtrl', ['$scope', '$compile', '$log', '$q', 'Member', 'SectionShape', 'Condition', 'MemberSection',\r\n    function($scope, $compile, $log, $q, Member, SectionShape, Condition, MemberSection) {\r\n      var ctrl = this;\r\n      ctrl.settings = {};\r\n\r\n      ctrl.settings.memberSections = {\r\n        minSpareRows: 1,\r\n        colHeaders: true,\r\n        nestedHeaders: [\r\n          [\r\n            /* 1*/ '<span header-rowspan=\"2\">部材<br>番号</span>',\r\n            /* 2*/ '<span header-rowspan=\"2\">部材長</span>',\r\n            /* 3*/ '<span header-rowspan=\"2\">グループ <br>No.</span>',\r\n            /* 4*/ '<span header-rowspan=\"2\">部材名</span>',\r\n            /* 5*/ '<span header-rowspan=\"2\">断面形状</span>',\r\n            /* 6*/ {label: '断面 (mm)', colspan: 4},\r\n            /* 7*/\r\n            /* 8*/\r\n            /* 9*/\r\n            /*10*/ {label: '環境条件', colspan: 3},\r\n            /*11*/\r\n            /*12*/\r\n            /*13*/ {label: '外観', colspan: 2},\r\n      \t    /*14*/\r\n      \t    /*15*/ 'ひび割',\r\n      \t    /*16*/ 'せん断',\r\n      \t    /*17*/ {label: '鉄筋 曲げ加工 r<sub>1</sub>', colspan: 3},\r\n      \t    /*18*/\r\n      \t    /*19*/\r\n      \t    /*20*/ '<span header-rowspan=\"2\" class=\"vertical-container\"><span class=\"vertical\">部材数</span></span>',\r\n      \t    /*21*/ '<span header-rowspan=\"2\">疲労<br>パス</span>'\r\n          ],\r\n          [\r\n            /* 1*/ '',\r\n            /* 2*/ '',\r\n            /* 3*/ '',\r\n            /* 4*/ '',\r\n            /* 5*/ '',\r\n            /* 6*/ 'B',\r\n            /* 7*/ 'H',\r\n            /* 8*/ 'B<sub>t</sub>',\r\n            /* 9*/ 't',\r\n            /*10*/ '上側',\r\n            /*11*/ '下側',\r\n            /*12*/ 'せん断',\r\n            /*13*/ '上側',\r\n            /*14*/ '下側',\r\n            /*15*/ '&epsilon;<sub>csd</sub>',\r\n            /*16*/ 'k<sub>r</sub>',\r\n            /*17*/ '軸鉄筋',\r\n            /*18*/ '帯筋',\r\n            /*19*/ '折曲げ',\r\n            /*20*/ '',\r\n            /*21*/ '',\r\n          ],\r\n        ],\r\n        columns: [\r\n          /* 1*/ {data: 'm_no'        , type: 'numeric'},\r\n          /* 2*/ {data: 'm_len'       , type: 'numeric', format: '0.000'},\r\n          /* 3*/ {data: 'g_no'        , type: 'numeric', format: '0.0'},\r\n          /* 4*/ {data: 'g_name'      , },\r\n          /* 5*/ {data: 'shape_no'    , type: 'numeric', renderer: SectionShape.renderName},\r\n          /* 6*/ {data: 'B'           , type: 'numeric'},\r\n          /* 7*/ {data: 'H'           , type: 'numeric'},\r\n          /* 8*/ {data: 'Bt'          , type: 'numeric'},\r\n          /* 9*/ {data: 't'           , type: 'numeric'},\r\n          /*10*/ {data: 'con_u'       , type: 'numeric'},\r\n          /*11*/ {data: 'con_l'       , type: 'numeric'},\r\n          /*12*/ {data: 'con_s'       , type: 'numeric'},\r\n          /*13*/ {data: 'vis_u'       , type: 'checkbox'},\r\n          /*14*/ {data: 'vis_l'       , type: 'checkbox'},\r\n          /*15*/ {data: 'ecsd'        , type: 'numeric'},\r\n          /*16*/ {data: 'kr'          , type: 'numeric', format: '0.0'},\r\n          /*17*/ {data: 'r1_1'        , type: 'numeric', format: '0.00'},\r\n          /*18*/ {data: 'r1_2'        , type: 'numeric', format: '0.00'},\r\n          /*19*/ {data: 'r1_3'        , type: 'numeric', format: '0.00'},\r\n          /*20*/ {data: 'n'           , type: 'numeric'},\r\n          /*21*/ {data: 'flg_fatigue' , type: 'checkbox'},\r\n        ],\r\n        afterChange: function(changes, source) {\r\n          (changes || []).forEach(function(change) {\r\n            let [idx, prop, oldVal, newVal] = change;\r\n            let memberSection = ctrl.memberSections[idx];\r\n            if (memberSection) {\r\n              memberSection.$dirty = true;\r\n            }\r\n          })\r\n        },\r\n        afterRender: function() {\r\n          $compile(this.rootElement)($scope);\r\n        },\r\n      };\r\n\r\n      ctrl.settings.sectionShapes = {\r\n        readOnly: true,\r\n        rowHeaders: true,\r\n        columns: [\r\n          {data: 'name'}\r\n        ],\r\n      };\r\n\r\n      ctrl.settings.conditions = {\r\n        readOnly: true,\r\n        rowHeaders: true,\r\n        columns: [\r\n          {data: 'name'}\r\n        ],\r\n      };\r\n\r\n      ctrl.isDirty = function() {\r\n        return (ctrl.memberSections || []).some(function(memberSection) {\r\n          return !!memberSection.$dirty;\r\n        });\r\n      }\r\n\r\n      ctrl.save = function() {\r\n        ctrl.memberSections.forEach(function(memberSection) {\r\n          if (!memberSection.$dirty) {\r\n            return;\r\n          }\r\n\r\n          try {\r\n            if (MemberSection.isEmpty(memberSection)) {\r\n              let idx = ctrl.memberSections.indexOf(memberSection);\r\n              if (!memberSection.$id) {\r\n                removeMemberSection(idx);\r\n              } else {\r\n                MemberSection.remove(memberSection).then(function(ref) {\r\n                  removeMemberSection(idx);\r\n                });\r\n              }\r\n            } else {\r\n              if (memberSection.$id) {\r\n                MemberSection.save(memberSection).then(function(ref) {\r\n                  resetDirty(memberSection);\r\n                });\r\n              } else {\r\n                MemberSection.add(memberSection).then(function(ref) {\r\n                  memberSection.$id = ref.key;\r\n                  resetDirty(memberSection);\r\n                });\r\n              }\r\n            }\r\n          } catch (e) {\r\n            $log.error(e);\r\n          }\r\n        })\r\n      }\r\n\r\n      function removeMemberSection(idx) {\r\n        ctrl.memberSections.splice(idx, 1);\r\n      }\r\n\r\n      function resetDirty(memberSection) {\r\n        memberSection.$dirty = false;\r\n      }\r\n\r\n      function init() {\r\n        ctrl.members = Member.query();\r\n        ctrl.sectionShapes = SectionShape.query();\r\n        ctrl.conditions = Condition.query();\r\n        ctrl.memberSections = MemberSection.query();\r\n      }\r\n\r\n      init();\r\n    }\r\n  ]);\r\n"]}