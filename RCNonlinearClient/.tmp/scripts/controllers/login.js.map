{"version":3,"sources":["controllers/login.js"],"names":["angular","module","controller","$scope","Auth","$location","$q","Ref","$timeout","oauthLogin","provider","err","$signInWithPopup","rememberMe","then","redirect","showError","anonymousLogin","$signInAnonymously","passwordLogin","email","pass","$signInWithPassword","password","createAccount","confirm","$createUser","createProfile","user","ref","child","uid","def","defer","set","name","firstPartOfEmail","reject","resolve","promise","ucfirst","substr","indexOf","str","f","charAt","toUpperCase","path"],"mappings":"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","file":"login.js","sourcesContent":["'use strict';\r\n/**\r\n * @ngdoc function\r\n * @name webdan.controller:LoginCtrl\r\n * @description\r\n * # LoginCtrl\r\n * Manages authentication to any active providers.\r\n */\r\nangular.module('webdan')\r\n  .controller('LoginCtrl', ['$scope', 'Auth', '$location', '$q', 'Ref', '$timeout',\r\n    function ($scope, Auth, $location, $q, Ref, $timeout) {\r\n      $scope.oauthLogin = function(provider) {\r\n        $scope.err = null;\r\n        Auth.$signInWithPopup(provider, {rememberMe: true}).then(redirect, showError);\r\n      };\r\n\r\n      $scope.anonymousLogin = function() {\r\n        $scope.err = null;\r\n        Auth.$signInAnonymously({rememberMe: true}).then(redirect, showError);\r\n      };\r\n\r\n      $scope.passwordLogin = function(email, pass) {\r\n        $scope.err = null;\r\n        Auth.$signInWithPassword({email: email, password: pass}, {rememberMe: true}).then(\r\n          redirect, showError\r\n        );\r\n      };\r\n\r\n      $scope.createAccount = function(email, pass, confirm) {\r\n        $scope.err = null;\r\n        if( !pass ) {\r\n          $scope.err = 'Please enter a password';\r\n        }\r\n        else if( pass !== confirm ) {\r\n          $scope.err = 'Passwords do not match';\r\n        }\r\n        else {\r\n          Auth.$createUser({email: email, password: pass})\r\n            .then(function () {\r\n              // authenticate so we have permission to write to Firebase\r\n              return Auth.$signInWithPassword({email: email, password: pass}, {rememberMe: true});\r\n            })\r\n            .then(createProfile)\r\n            .then(redirect, showError);\r\n        }\r\n\r\n        function createProfile(user) {\r\n          var ref = Ref.child('users', user.uid), def = $q.defer();\r\n          ref.set({email: email, name: firstPartOfEmail(email)}, function(err) {\r\n            $timeout(function() {\r\n              if( err ) {\r\n                def.reject(err);\r\n              }\r\n              else {\r\n                def.resolve(ref);\r\n              }\r\n            });\r\n          });\r\n          return def.promise;\r\n        }\r\n      };\r\n\r\n      function firstPartOfEmail(email) {\r\n        return ucfirst(email.substr(0, email.indexOf('@'))||'');\r\n      }\r\n\r\n      function ucfirst (str) {\r\n        // inspired by: http://kevin.vanzonneveld.net\r\n        str += '';\r\n        var f = str.charAt(0).toUpperCase();\r\n        return f + str.substr(1);\r\n      }\r\n\r\n      function redirect() {\r\n        $location.path('/account');\r\n      }\r\n\r\n      function showError(err) {\r\n        $scope.err = err;\r\n      }\r\n    }\r\n  ]);\r\n"]}