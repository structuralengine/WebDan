{"version":3,"sources":["controllers/account.js"],"names":["angular","module","controller","$scope","user","Auth","Ref","$firebaseObject","$timeout","logout","$signOut","messages","profile","child","uid","$bindTo","changePassword","oldPass","newPass","confirm","err","error","$changePassword","email","oldPassword","newPassword","then","success","changeEmail","pass","newEmail","$changeEmail","password","oldEmail","$save","catch","alert","msg","type","obj","text","unshift","splice","indexOf"],"mappings":"AAAA;AACA;;;;;;;;AAOAA,QAAQC,MAAR,CAAe,QAAf,EACGC,UADH,CACc,aADd,EAC6B,CAAC,QAAD,EAAW,MAAX,EAAmB,MAAnB,EAA2B,KAA3B,EAAkC,iBAAlC,EAAqD,UAArD,EACzB,UAAUC,MAAV,EAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,GAA9B,EAAmCC,eAAnC,EAAoDC,QAApD,EAA8D;;AAE5DL,SAAOC,IAAP,GAAcA,IAAd;AACAD,SAAOM,MAAP,GAAgB,YAAW;AAAEJ,SAAKK,QAAL;AAAkB,GAA/C;AACAP,SAAOQ,QAAP,GAAkB,EAAlB;AACA,MAAIC,UAAUL,gBAAgBD,IAAIO,KAAJ,CAAU,WAAST,KAAKU,GAAxB,CAAhB,CAAd;AACAF,UAAQG,OAAR,CAAgBZ,MAAhB,EAAwB,SAAxB;;AAGAA,SAAOa,cAAP,GAAwB,UAASC,OAAT,EAAkBC,OAAlB,EAA2BC,OAA3B,EAAoC;AAC1DhB,WAAOiB,GAAP,GAAa,IAAb;AACA,QAAI,CAACH,OAAD,IAAY,CAACC,OAAjB,EAA2B;AACzBG,YAAM,yBAAN;AACD,KAFD,MAGK,IAAIH,YAAYC,OAAhB,EAA0B;AAC7BE,YAAM,wBAAN;AACD,KAFI,MAGA;AACHhB,WAAKiB,eAAL,CAAqB,EAACC,OAAOX,QAAQW,KAAhB,EAAuBC,aAAaP,OAApC,EAA6CQ,aAAaP,OAA1D,EAArB,EACGQ,IADH,CACQ,YAAW;AACfC,gBAAQ,kBAAR;AACD,OAHH,EAGKN,KAHL;AAID;AACF,GAdD;;AAgBAlB,SAAOyB,WAAP,GAAqB,UAASC,IAAT,EAAeC,QAAf,EAAyB;AAC5C3B,WAAOiB,GAAP,GAAa,IAAb;AACAf,SAAK0B,YAAL,CAAkB,EAACC,UAAUH,IAAX,EAAiBC,UAAUA,QAA3B,EAAqCG,UAAUrB,QAAQW,KAAvD,EAAlB,EACGG,IADH,CACQ,YAAW;AACfd,cAAQW,KAAR,GAAgBO,QAAhB;AACAlB,cAAQsB,KAAR;AACAP,cAAQ,eAAR;AACD,KALH,EAMGQ,KANH,CAMSd,KANT;AAOD,GATD;;AAWA,WAASA,KAAT,CAAeD,GAAf,EAAoB;AAClBgB,UAAMhB,GAAN,EAAW,QAAX;AACD;;AAED,WAASO,OAAT,CAAiBU,GAAjB,EAAsB;AACpBD,UAAMC,GAAN,EAAW,SAAX;AACD;;AAED,WAASD,KAAT,CAAeC,GAAf,EAAoBC,IAApB,EAA0B;AACxB,QAAIC,MAAM,EAACC,MAAMH,MAAI,EAAX,EAAeC,MAAMA,IAArB,EAAV;AACAnC,WAAOQ,QAAP,CAAgB8B,OAAhB,CAAwBF,GAAxB;AACA/B,aAAS,YAAW;AAClBL,aAAOQ,QAAP,CAAgB+B,MAAhB,CAAuBvC,OAAOQ,QAAP,CAAgBgC,OAAhB,CAAwBJ,GAAxB,CAAvB,EAAqD,CAArD;AACD,KAFD,EAEG,KAFH;AAGD;AAEF,CArDwB,CAD7B","file":"account.js","sourcesContent":["'use strict';\r\n/**\r\n * @ngdoc function\r\n * @name muck2App.controller:AccountCtrl\r\n * @description\r\n * # AccountCtrl\r\n * Provides rudimentary account management functions.\r\n */\r\nangular.module('webdan')\r\n  .controller('AccountCtrl', ['$scope', 'user', 'Auth', 'Ref', '$firebaseObject', '$timeout',\r\n    function ($scope, user, Auth, Ref, $firebaseObject, $timeout) {\r\n\r\n      $scope.user = user;\r\n      $scope.logout = function() { Auth.$signOut(); };\r\n      $scope.messages = [];\r\n      var profile = $firebaseObject(Ref.child('users/'+user.uid));\r\n      profile.$bindTo($scope, 'profile');\r\n\r\n\r\n      $scope.changePassword = function(oldPass, newPass, confirm) {\r\n        $scope.err = null;\r\n        if( !oldPass || !newPass ) {\r\n          error('Please enter all fields');\r\n        }\r\n        else if( newPass !== confirm ) {\r\n          error('Passwords do not match');\r\n        }\r\n        else {\r\n          Auth.$changePassword({email: profile.email, oldPassword: oldPass, newPassword: newPass})\r\n            .then(function() {\r\n              success('Password changed');\r\n            }, error);\r\n        }\r\n      };\r\n\r\n      $scope.changeEmail = function(pass, newEmail) {\r\n        $scope.err = null;\r\n        Auth.$changeEmail({password: pass, newEmail: newEmail, oldEmail: profile.email})\r\n          .then(function() {\r\n            profile.email = newEmail;\r\n            profile.$save();\r\n            success('Email changed');\r\n          })\r\n          .catch(error);\r\n      };\r\n\r\n      function error(err) {\r\n        alert(err, 'danger');\r\n      }\r\n\r\n      function success(msg) {\r\n        alert(msg, 'success');\r\n      }\r\n\r\n      function alert(msg, type) {\r\n        var obj = {text: msg+'', type: type};\r\n        $scope.messages.unshift(obj);\r\n        $timeout(function() {\r\n          $scope.messages.splice($scope.messages.indexOf(obj), 1);\r\n        }, 10000);\r\n      }\r\n\r\n    }\r\n  ]);\r\n"]}